<!DOCTYPE html>
<html>
    <head>
        <title>Upload new File</title>
    </head>
    <body>
        <h1>Upload new File</h1>
        <input id="lungImageUpload" type="file" name="file">
        <button id="submitTb">Submit Lung Image</button>

        <div id="tbPrediction"></div>
        <img id="tbImage" src="" alt="TB Result">
        <h1>Upload text for summary</h1>
        
        <form id="summary_form">
            <textarea name="text" placeholder="Enter text here" rows="4" cols="50" style="width: 100%;"></textarea>
            <input type="button" value="Submit" onclick="submitSummary()">
        </form>
        <div id="summary"></div>
        <div id="status_message"></div>  <!-- Add this to show status messages -->
        


        <form id="translation_form">
            <h1>Translate Text</h1>
            <select name="language" id="language_select">
                <option value="Hindi">Hindi</option>
                <option value="Nepali">Nepali</option>
                <option value="Marathi">Marathi</option>
                <option value="Bengali">Bengali</option>
                <option value="Arabic">Arabic</option>
                <option value="Filipino">Filipino</option>
                <option value="French">French</option>
                <option value="Spanish">Spanish</option>
                <option value="Igbo">IGBO (Nigeria)</option>
            </select>
            <input type="button" value="Translate" onclick="submitTranslation()">
        </form>
        <div id="translation_result"></div>

        <div id="summary"></div>
        
        <div id="translation"></div>
        <script>
            document.getElementById("submitTb").onclick = function() {
                let input = document.getElementById('lungImageUpload');
                let data = new FormData();
                data.append('file', input.files[0]);
                const filename = input.files[0].name;
                const uploadedUrl = "http://localhost:4000/static/".concat(filename);
                console.log({uploadedUrl});
                const url = "http://localhost:4000/api/predict_tb";

                let response = fetch(url, {
                    method: "POST", // *GET, POST, PUT, DELETE, etc.
                    body: data // body data type must match "Content-Type" header
                }).then(response => response.json())
                .then(data => {
                    const class_id = data.class_id;
                    console.log(data);
                    console.log({class_id});
                    console.log(class_id.toString());
                    document.getElementById("tbPrediction").innerText = class_id.toString();
                    document.getElementById("tbImage").src=uploadedUrl;
                });
            };

            function submitSummary() {
                const formData = new FormData(document.getElementById('summary_form'));
                const text = formData.get('text');  // Get the text input from the form

                // Show waiting message
                document.getElementById('status_message').innerText = 'Waiting for response...';

                fetch('http://localhost:4000/api/summarize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })  // Convert the text to JSON
                })
                .then(response => response.json())
                .then(data => {
                    // Clear the waiting message
                    document.getElementById('status_message').innerText = '';
                    
                    if (data.error) {
                        document.getElementById('summary').innerText = 'Error: ' + data.error;
                    } else {
                        document.getElementById('summary').innerText = 'Summary: ' + data.summary;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('status_message').innerText = '';
                    document.getElementById('summary').innerText = 'Error: ' + error;
                });
            }

            function submitTranslation() {
                    const text = document.getElementById('summary').innerText;
                    const language = document.getElementById('language_select').value;

                    document.getElementById('translation_result').innerText = 'Waiting for translation...';

                    fetch('http://localhost:4000/api/translate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ text: text, language: language })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            document.getElementById('translation_result').innerText = 'Error: ' + data.error;
                        } else {
                            document.getElementById('translation_result').innerText = 'Translated Text: ' + data.translated_text;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('translation_result').innerText = 'Error: ' + error.toString();
                    });
                }
        </script>
    </body>
</html>